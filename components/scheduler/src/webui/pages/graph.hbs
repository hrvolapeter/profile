{{> header}}

<h1>Current flow graph</h1>

<div id="flow-graph"></div>

<script type="text/javascript">
let socket = new WebSocket("ws://" + window.location.host + "/api/schedule/graph/");
socket.onopen = function(e) {
  {{!-- alert("[open] Connection established"); --}}
};

socket.onmessage = function(event) {
    let data = JSON.parse(event.data)
    let nodes = data.nodes
    let edges = data.edges
    plotNetwork(nodes, edges)
};

socket.onclose = function(event) {
  if (event.wasClean) {
    alert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
  } else {
    // e.g. server process killed or network down
    // event.code is usually 1006 in this case
    alert('[close] Connection died');
  }
};

socket.onerror = function(error) {
  alert(`[error] ${error.message}`);
};

function plotNetwork(nodes, edges) {
  // create a network
  var container = document.getElementById('flow-graph');
  var data = {
    nodes: nodes,
    edges: edges
  };
  var options = {
    layout: {
    },
    edges: {
      smooth: true,
      arrows: {to : true }
    }
  };
  var network = new vis.Network(container, data, options);
}
</script>

{{> footer }}